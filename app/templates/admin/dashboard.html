{% extends "partials/base.html" %} {% block title %}Admin Dashboard{% endblock
%} {% block content %}
<div class="container mt-5">
  <h2 class="mb-4">Admin Dashboard</h2>

  <div class="mb-3">
    <a href="{{ url_for('admin.add_event') }}" class="btn btn-primary">
      â• Add New Event
    </a>
  </div>

  {% if events %}
  <h4>Events</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Location</th>
        <th>Dates</th>
        <th>Flight Info</th>
        <th>Cheer Level</th>
        <th>Assigned Coaches</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for event in events %}
      <tr>
        <td>{{ event.name }}</td>
        <td>{{ event.location }}</td>
        <td>
          {% set sorted_days = event.event_days |
          sort(attribute='start_datetime') %} {% if sorted_days %} {{
          sorted_days[0].start_datetime.strftime('%b %d, %Y %I:%M %p') }} to {{
          sorted_days[-1].end_datetime.strftime('%b %d, %Y %I:%M %p') }} {% else
          %}
          <em>No dates set</em>
          {% endif %}
        </td>
        <td>
          {% if event.flights %} {% for flight in event.flights %}
          <strong>{{ flight.name or "Unnamed" }}</strong><br />
          âœ‰ï¸ {{ flight.email }}<br />
          {{ flight.flight_airline or 'â€”' }}<br />
          âœˆï¸ Depart: {{ flight.flight_departure_datetime.strftime('%m/%d %I:%M
          %p') if flight.flight_departure_datetime else 'â€”' }}<br />
          Return: {{ flight.flight_return_datetime.strftime('%m/%d %I:%M %p') if
          flight.flight_return_datetime else 'â€”' }}<br />
          ğŸ” {{ flight.flight_confirmation_code or 'â€”' }}<br />
          <hr class="my-1" />
          {% endfor %} {% else %}
          <em>No flight info</em>
          {% endif %}
        </td>

        <td>{{ event.cheer_level }}</td>
        <td>
          {% if event.assignments %}
          <ul class="mb-0 ps-3">
            {% for assignment in event.assignments %}
            <li>
              {% if assignment.user.fullname %} {{ assignment.user.fullname }}
              ({{ assignment.user.email }}) {% else %} {{ assignment.user.email
              }} {% endif %}
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <em>No coaches assigned</em>
          {% endif %}
        </td>
        <td>
          <a
            href="{{ url_for('admin.edit_event', event_id=event.id) }}"
            class="btn btn-sm btn-secondary"
            >Edit</a
          >
          <form
            action="{{ url_for('admin.delete_event', event_id=event.id) }}"
            method="POST"
            style="display: inline"
          >
            <button
              class="btn btn-sm btn-danger"
              onclick="return confirm('Delete this event?')"
            >
              Delete
            </button>
          </form>
          <a
            href="{{ url_for('admin.assign_user', event_id=event.id) }}"
            class="btn btn-sm btn-info"
            >Assign User</a
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No events found. Click â€œAdd New Eventâ€ to create one.</p>
  {% endif %}
</div>
{% endblock %}
